<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wika News | ÙˆÙŠÙƒØ§ Ù†ÙŠÙˆØ²</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e74c3c">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #e74c3c; --bg: #0f0f0f; --card-bg: #1a1a1a; --text-main: #ffffff; --text-dim: #b3b3b3; --glass: rgba(255, 255, 255, 0.05); }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg); color: var(--text-main); margin: 0; padding: 0; overflow-x: hidden; }
        header { background: rgba(15, 15, 15, 0.95); backdrop-filter: blur(10px); padding: 12px 0; text-align: center; border-bottom: 1px solid var(--glass); position: sticky; top: 0; z-index: 1000; }
        .logo-img { height: 40px; }
        .breaking-news-container { padding: 12px; }
        .breaking-card { background: linear-gradient(135deg, var(--primary), #c0392b); border-radius: 12px; padding: 12px; display: flex; align-items: center; gap: 12px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); }
        .breaking-badge { background: #fff; color: var(--primary); padding: 4px 12px; border-radius: 6px; font-weight: bold; font-size: 0.85rem; white-space: nowrap; }
        #breaking-text { font-weight: 700; font-size: 0.95rem; line-height: 1.4; transition: opacity 0.3s; flex-grow: 1; }
        nav { background: var(--card-bg); display: flex; padding: 10px; gap: 8px; overflow-x: auto; scrollbar-width: none; position: sticky; top: 65px; z-index: 999; border-bottom: 1px solid var(--glass); }
        nav::-webkit-scrollbar { display: none; }
        nav button { background: var(--glass); color: var(--text-dim); border: none; padding: 8px 18px; border-radius: 20px; cursor: pointer; font-weight: bold; white-space: nowrap; font-family: inherit; }
        nav button.active { background: var(--primary); color: white; }
        .container { max-width: 1000px; margin: 10px auto; padding: 0 12px; }
        .news-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; }
        .news-card { background: var(--card-bg); border-radius: 15px; overflow: hidden; text-decoration: none; color: inherit; transition: 0.3s; border: 1px solid var(--glass); display: flex; flex-direction: column; }
        .news-image { width: 100%; height: 170px; object-fit: cover; background: #252525; }
        .news-body { padding: 15px; flex-grow: 1; }
        .news-title { font-size: 1.05rem; font-weight: 700; line-height: 1.5; margin-bottom: 10px; color: #fff; }
        .news-footer { display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-dim); border-top: 1px solid var(--glass); padding-top: 10px; }
        #loader { text-align: center; padding: 50px; color: var(--primary); font-weight: bold; }
        .retry-btn { display: none; margin: 20px auto; padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<header>
    <img src="Picsart_26-01-20_05-35-29-021.png" alt="Wika News" class="logo-img">
</header>

<div class="breaking-news-container">
    <div class="breaking-card">
        <span class="breaking-badge">Ø¹Ø§Ø¬Ù„</span>
        <div id="breaking-text">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ¬Ø¯Ø§Øª...</div>
    </div>
</div>

<nav>
    <button class="active" onclick="changeCategory('all', this)">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button onclick="changeCategory('politics', this)">Ø³ÙŠØ§Ø³Ø©</button>
    <button onclick="changeCategory('sports', this)">Ø±ÙŠØ§Ø¶Ø©</button>
    <button onclick="changeCategory('economy', this)">Ø§Ù‚ØªØµØ§Ø¯</button>
</nav>

<div class="container">
    <div id="news-container" class="news-grid"></div>
    <div id="loader">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±...</div>
    <button id="retry-btn" class="retry-btn" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©</button>
</div>

<script>
    let allPosts = [];
    let breakingIndex = 0;
    const proxyUrl = "https://api.allorigins.win/get?url=";
    const rssSource = "https://www.ina.iq/rss.xml";

    async function fetchNews(category = 'all') {
        const container = document.getElementById('news-container');
        const loader = document.getElementById('loader');
        const retryBtn = document.getElementById('retry-btn');
        
        container.innerHTML = '';
        loader.style.display = 'block';
        retryBtn.style.display = 'none';
        
        try {
            const response = await fetch(`${proxyUrl}${encodeURIComponent(rssSource)}&t=${Date.now()}`);
            if (!response.ok) throw new Error();
            const data = await response.json();
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data.contents, "text/xml");
            const items = Array.from(xmlDoc.querySelectorAll("item"));

            allPosts = items.map(item => {
                const title = item.querySelector("title").textContent;
                const link = item.querySelector("link").textContent;
                const desc = item.querySelector("description") ? item.querySelector("description").textContent : "";
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø°ÙƒÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ù„Ù„Ø®Ø¨Ø±
                const imgMatch = desc.match(/<img[^>]+src="([^">]+)"/);
                const image = imgMatch ? imgMatch[1] : "https://www.ina.iq/assets/img/logo_ina.png";

                return { title, link, image };
            });

            if (category !== 'all') {
                const keywords = {
                    politics: ['Ø³ÙŠØ§Ø³', 'Ø­ÙƒÙˆÙ…', 'Ù…Ø¬Ù„Ø³', 'ÙˆØ²ÙŠØ±', 'Ø¨Ø±Ù„Ù…Ø§Ù†'],
                    sports: ['Ø±ÙŠØ§Ø¶', 'ÙƒØ±Ø©', 'Ù…Ù†ØªØ®Ø¨', 'Ù†Ø§Ø¯ÙŠ', 'Ù…Ø¨Ø§Ø±Ø§Ø©'],
                    economy: ['Ø§Ù‚ØªØµØ§Ø¯', 'Ù…Ø§Ù„', 'Ø¯ÙˆÙ„Ø§Ø±', 'Ø¯ÙŠÙ†Ø§Ø±', 'Ø³Ø¹Ø±']
                };
                allPosts = allPosts.filter(p => keywords[category].some(k => p.title.includes(k)));
            }

            loader.style.display = 'none';
            renderNews();
            if(category === 'all') startBreaking();
        } catch (e) {
            loader.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…ØµØ¯Ø±.";
            retryBtn.style.display = 'block';
        }
    }

    function renderNews() {
        const container = document.getElementById('news-container');
        if (allPosts.length === 0) {
            container.innerHTML = "<p style='text-align:center; width:100%;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø¨Ø§Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
            return;
        }
        allPosts.forEach(post => {
            container.innerHTML += `
                <a href="${post.link}" target="_blank" class="news-card">
                    <img src="${post.image}" class="news-image" onerror="this.src='https://www.ina.iq/assets/img/logo_ina.png'">
                    <div class="news-body">
                        <h3 class="news-title">${post.title}</h3>
                        <div class="news-footer">
                            <span>ğŸ•’ ÙˆÙƒØ§Ù„Ø© ÙˆØ§Ø¹</span>
                            <span>Ø§Ù„ØªÙØ§ØµÙŠÙ„ â†</span>
                        </div>
                    </div>
                </a>
            `;
        });
    }

    function startBreaking() {
        const text = document.getElementById('breaking-text');
        if (allPosts.length === 0) return;
        text.innerText = allPosts[0].title;
        if(window.timer) clearInterval(window.timer);
        window.timer = setInterval(() => {
            text.style.opacity = 0;
            setTimeout(() => {
                breakingIndex = (breakingIndex + 1) % Math.min(allPosts.length, 10);
                text.innerText = allPosts[breakingIndex].title;
                text.style.opacity = 1;
            }, 300);
        }, 5000);
    }

    function changeCategory(cat, btn) {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        fetchNews(cat);
    }

    fetchNews();
</script>
</body>
</html>
