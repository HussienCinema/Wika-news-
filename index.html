<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wika News | ÙˆÙŠÙƒØ§ Ù†ÙŠÙˆØ²</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e74c3c">
    <style>
        :root { --primary: #e74c3c; --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; line-height: 1.6; overflow-x: hidden; }
        header { background: var(--bg); padding: 15px; text-align: center; border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .logo-img { height: 45px; }
        
        .breaking-card { background: #fff; color: #000; margin: 12px; border-radius: 12px; display: flex; flex-direction: column; min-height: 85px; border-right: 8px solid var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .breaking-header { background: var(--primary); color: #fff; padding: 4px 15px; font-weight: bold; font-size: 0.85rem; width: fit-content; border-radius: 0 0 10px 0; }
        #breaking-content { padding: 8px 12px; font-weight: bold; font-size: 1rem; transition: opacity 0.4s; }

        nav { background: #252525; display: flex; overflow-x: auto; padding: 10px; gap: 8px; border-bottom: 1px solid #333; scrollbar-width: none; position: sticky; top: 77px; z-index: 999; }
        nav::-webkit-scrollbar { display: none; }
        nav button { background: #333; color: #fff; border: none; padding: 8px 18px; border-radius: 20px; cursor: pointer; white-space: nowrap; font-weight: bold; font-size: 0.9rem; transition: 0.2s; }
        nav button.active { background: var(--primary); }

        .container { padding: 12px; max-width: 800px; margin: auto; min-height: 60vh; }
        .news-card { background: var(--card); border-radius: 12px; margin-bottom: 15px; display: block; border-right: 5px solid var(--primary); text-decoration: none; color: inherit; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .news-content { padding: 15px; }
        .news-title { font-size: 1.1rem; font-weight: bold; color: #fff; margin: 0; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .news-meta { font-size: 0.8rem; color: #aaa; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; }

        .load-more-btn { display: none; width: 95%; padding: 15px; margin: 15px auto; background: var(--primary); color: #fff; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        #loading-text { text-align: center; padding: 30px; color: var(--primary); font-size: 1.1rem; font-weight: bold; }
        
        #install-banner { display: none; background: #2ecc71; color: white; padding: 10px; text-align: center; font-weight: bold; cursor: pointer; position: fixed; bottom: 0; width: 100%; z-index: 2000; }
    </style>
</head>
<body>

<div id="install-banner" onclick="installPWA()">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠÙƒØ§ Ù†ÙŠÙˆØ² Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ ğŸ“²</div>

<header>
    <img src="Picsart_26-01-20_05-35-29-021.png" alt="Wika News" class="logo-img">
</header>

<div class="breaking-card">
    <div class="breaking-header">Ø¹Ø§Ø¬Ù„</div>
    <div id="breaking-content">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©...</div>
</div>

<nav>
    <button class="active" onclick="changeCategory('all', this)">Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</button>
    <button onclick="changeCategory('politics', this)">Ø³ÙŠØ§Ø³Ø©</button>
    <button onclick="changeCategory('sports', this)">Ø±ÙŠØ§Ø¶Ø©</button>
    <button onclick="changeCategory('economy', this)">Ø§Ù‚ØªØµØ§Ø¯</button>
    <button onclick="changeCategory('local', this)">Ù…Ø­Ù„ÙŠØ§Øª</button>
</nav>

<div class="container">
    <div id="news-container"></div>
    <div id="loading-text">Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠØ©...</div>
    <button id="load-more" class="load-more-btn" onclick="renderNews()">ğŸ‘‡ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</button>
</div>

<script>
    let allPosts = [];
    let displayedCount = 0;
    const increment = 12;
    let breakingIndex = 0;
    let deferredPrompt;

    // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø­Ø±Ùƒ Ø£Ø³Ø±Ø¹ ÙˆØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù„Ø¶Ù…Ø§Ù† ØºØ²Ø§Ø±Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
    const proxyUrl = "https://api.allorigins.win/get?url=";
    const sources = {
        all: "https://www.ina.iq/rss.xml",
        politics: "https://www.ina.iq/rss.xml",
        sports: "https://www.ina.iq/rss.xml",
        economy: "https://www.ina.iq/rss.xml",
        local: "https://www.ina.iq/rss.xml"
    };

    async function fetchNews(category = 'all') {
        const container = document.getElementById('news-container');
        const loader = document.getElementById('loading-text');
        const loadMoreBtn = document.getElementById('load-more');
        
        container.innerHTML = '';
        loader.style.display = 'block';
        loader.innerText = "Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©...";
        loadMoreBtn.style.display = 'none';
        
        try {
            // Ø¬Ù„Ø¨ 100 Ø®Ø¨Ø± Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ÙˆÙØ±Ø©
            const response = await fetch(`${proxyUrl}${encodeURIComponent(sources[category])}&cache=${Date.now()}`);
            const data = await response.json();
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data.contents, "text/xml");
            const items = Array.from(xmlDoc.querySelectorAll("item"));

            allPosts = [];
            items.forEach(item => {
                const title = item.querySelector("title").textContent;
                const link = item.querySelector("link").textContent;
                const pubDate = item.querySelector("pubDate") ? item.querySelector("pubDate").textContent : "";
                
                if (category === 'all') {
                    allPosts.push({ title, link, pubDate });
                } else {
                    const keywords = {
                        politics: ['Ø³ÙŠØ§Ø³', 'Ø­ÙƒÙˆÙ…', 'Ø¨Ø±Ù„Ù…Ø§Ù†', 'ÙˆØ²ÙŠØ±', 'Ø§Ù†ØªØ®Ø§Ø¨', 'Ù…Ø¬Ù„Ø³', 'Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠ'],
                        sports: ['Ø±ÙŠØ§Ø¶', 'ÙƒØ±Ø©', 'Ù…Ù†ØªØ®Ø¨', 'Ù†Ø§Ø¯ÙŠ', 'Ù…Ø¨Ø§Ø±Ø§Ø©', 'Ù„Ø§Ø¹Ø¨', 'Ù‡Ø¯Ù', 'Ø¯ÙˆØ±ÙŠ'],
                        economy: ['Ø§Ù‚ØªØµØ§Ø¯', 'Ù…Ø§Ù„', 'Ø³Ø¹Ø±', 'Ø¯ÙˆÙ„Ø§Ø±', 'Ø¯ÙŠÙ†Ø§Ø±', 'Ù†ÙØ·', 'ØªØ¬Ø§Ø±Ø©', 'Ù…ØµØ±Ù'],
                        local: ['Ù…Ø­Ù„ÙŠ', 'Ø¨ØºØ¯Ø§Ø¯', 'Ù…Ø­Ø§ÙØ¸Ø©', 'ØµØ­Ø©', 'ØªØ¹Ù„ÙŠÙ…', 'Ù…Ø±ÙˆØ±', 'Ø·Ù‚Ø³']
                    };
                    if (keywords[category].some(key => title.includes(key))) {
                        allPosts.push({ title, link, pubDate });
                    }
                }
            });

            if (allPosts.length > 0) {
                loader.style.display = 'none';
                displayedCount = 0;
                renderNews();
                if(category === 'all') startTicker();
            } else {
                // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ÙÙŠ Ø§Ù„ÙÙ„ØªØ±Ø©ØŒ Ù†Ø¹Ø±Ø¶ Ø£Ø®Ø¨Ø§Ø± "Ø§Ù„ÙƒÙ„" Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ÙØ±Ø§Øº
                if(category !== 'all') fetchNews('all');
                else loader.innerText = "Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©...";
            }
        } catch (e) {
            loader.innerText = "Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©...";
        }
    }

    function renderNews() {
        const container = document.getElementById('news-container');
        const loadMoreBtn = document.getElementById('load-more');
        const chunk = allPosts.slice(displayedCount, displayedCount + increment);
        
        chunk.forEach(post => {
            const card = document.createElement('a');
            card.className = 'news-card';
            card.href = post.link;
            card.target = '_blank';
            card.innerHTML = `
                <div class="news-content">
                    <h3 class="news-title">${post.title}</h3>
                    <div class="news-meta">
                        <span>ğŸ•’ ÙˆØ§Ø¹</span>
                        <span>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø¨Ø± â†</span>
                    </div>
                </div>
            `;
            container.appendChild(card);
        });

        displayedCount += increment;
        loadMoreBtn.style.display = (displayedCount < allPosts.length) ? 'block' : 'none';
    }

    function startTicker() {
        const content = document.getElementById('breaking-content');
        if(!allPosts.length) return;
        content.innerText = allPosts[0].title;
        if(window.tickerInterval) clearInterval(window.tickerInterval);
        window.tickerInterval = setInterval(() => {
            content.style.opacity = 0;
            setTimeout(() => {
                breakingIndex = (breakingIndex + 1) % Math.min(allPosts.length, 20);
                content.innerText = allPosts[breakingIndex].title;
                content.style.opacity = 1;
            }, 400);
        }, 6000);
    }

    function changeCategory(cat, btn) {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        fetchNews(cat);
    }

    // Ø¥Ø¯Ø§Ø±Ø© ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('install-banner').style.display = 'block';
    });

    function installPWA() {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    document.getElementById('install-banner').style.display = 'none';
                }
                deferredPrompt = null;
            });
        }
    }

    fetchNews();
</script>
</body>
</html>
