<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wika News | ÙˆÙŠÙƒØ§ Ù†ÙŠÙˆØ²</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#e74c3c">
    <style>
        :root { --primary: #e74c3c; --bg: #121212; --card: #1e1e1e; --text: #e0e0e0; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; line-height: 1.6; }
        header { background: var(--bg); padding: 15px; text-align: center; border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 1000; }
        .logo-img { height: 50px; }
        .breaking-card { background: #fff; color: #000; margin: 15px; border-radius: 12px; display: flex; flex-direction: column; min-height: 90px; border-right: 8px solid var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .breaking-header { background: var(--primary); color: #fff; padding: 5px 20px; font-weight: bold; font-size: 0.9rem; width: fit-content; border-radius: 0 0 10px 0; }
        #breaking-content { padding: 10px 15px; font-weight: bold; font-size: 1.1rem; transition: opacity 0.5s; }
        nav { background: #252525; display: flex; overflow-x: auto; padding: 10px; gap: 10px; border-bottom: 1px solid #333; }
        nav button { background: #333; color: #fff; border: none; padding: 10px 22px; border-radius: 25px; cursor: pointer; white-space: nowrap; font-weight: bold; }
        nav button.active { background: var(--primary); }
        .container { padding: 15px; max-width: 800px; margin: auto; }
        .news-card { background: var(--card); border-radius: 15px; margin-bottom: 20px; display: block; border-right: 6px solid var(--primary); text-decoration: none; color: inherit; }
        .news-content { padding: 20px; }
        .news-title { font-size: 1.25rem; font-weight: bold; color: #fff; margin: 0; line-height: 1.5; }
        .news-meta { font-size: 0.85rem; color: #aaa; margin-top: 15px; display: flex; justify-content: space-between; }
        .load-more-btn { display: none; width: 100%; padding: 18px; margin: 20px 0; background: var(--primary); color: #fff; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        #loading-text { text-align: center; padding: 40px; color: var(--primary); font-size: 1.2rem; font-weight: bold; }
    </style>
</head>
<body>

<header>
    <img src="Picsart_26-01-20_05-35-29-021.png" alt="Wika News" class="logo-img">
</header>

<div class="breaking-card">
    <div class="breaking-header">Ø¹Ø§Ø¬Ù„</div>
    <div id="breaking-content">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±...</div>
</div>

<nav>
    <button class="active" onclick="changeCategory('all', this)">Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</button>
    <button onclick="changeCategory('politics', this)">Ø³ÙŠØ§Ø³Ø©</button>
    <button onclick="changeCategory('sports', this)">Ø±ÙŠØ§Ø¶Ø©</button>
    <button onclick="changeCategory('economy', this)">Ø§Ù‚ØªØµØ§Ø¯</button>
</nav>

<div class="container">
    <div id="news-container"></div>
    <div id="loading-text">Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠØ©...</div>
    <button id="load-more" class="load-more-btn" onclick="renderNews()">ğŸ‘‡ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø®Ø¨Ø§Ø±</button>
</div>

<script>
    let allPosts = [];
    let displayedCount = 0;
    const increment = 10;
    let breakingIndex = 0;

    const proxyUrl = "https://api.allorigins.win/get?url=";
    const rssSource = "https://www.ina.iq/rss.xml";

    async function fetchNews(category = 'all') {
        const container = document.getElementById('news-container');
        const loader = document.getElementById('loading-text');
        const loadMoreBtn = document.getElementById('load-more');
        
        container.innerHTML = '';
        loader.style.display = 'block';
        loader.innerText = "Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠØ©...";
        loadMoreBtn.style.display = 'none';
        
        try {
            const response = await fetch(`${proxyUrl}${encodeURIComponent(rssSource)}&cache=${Date.now()}`);
            const data = await response.json();
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data.contents, "text/xml");
            const items = xmlDoc.querySelectorAll("item");

            allPosts = [];
            items.forEach(item => {
                const title = item.querySelector("title").textContent;
                const link = item.querySelector("link").textContent;
                const pubDate = item.querySelector("pubDate") ? item.querySelector("pubDate").textContent : "";
                
                if (category === 'all') {
                    allPosts.push({ title, link, pubDate });
                } else {
                    const keywords = {
                        politics: ['Ø³ÙŠØ§Ø³', 'Ø­ÙƒÙˆÙ…', 'Ù…Ø¬Ù„Ø³', 'Ø¨Ø±Ù„Ù…Ø§Ù†', 'ÙˆØ²ÙŠØ±'],
                        sports: ['Ø±ÙŠØ§Ø¶', 'ÙƒØ±Ø©', 'Ù…Ù†ØªØ®Ø¨', 'Ù†Ø§Ø¯ÙŠ', 'Ù„Ø§Ø¹Ø¨'],
                        economy: ['Ø§Ù‚ØªØµØ§Ø¯', 'Ù…Ø§Ù„', 'Ø³Ø¹Ø±', 'Ø¯ÙˆÙ„Ø§Ø±', 'Ø¯ÙŠÙ†Ø§Ø±', 'Ù†ÙØ·']
                    };
                    if (keywords[category].some(key => title.includes(key))) {
                        allPosts.push({ title, link, pubDate });
                    }
                }
            });

            if (allPosts.length > 0) {
                loader.style.display = 'none';
                displayedCount = 0;
                renderNews();
                if(category === 'all') startTicker();
            } else {
                // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ùƒ
                loader.innerText = "Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©...";
            }
        } catch (e) {
            loader.innerText = "Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©...";
        }
    }

    function renderNews() {
        const container = document.getElementById('news-container');
        const loadMoreBtn = document.getElementById('load-more');
        const chunk = allPosts.slice(displayedCount, displayedCount + increment);
        
        chunk.forEach(post => {
            container.innerHTML += `
                <a href="${post.link}" target="_blank" class="news-card">
                    <div class="news-content">
                        <h3 class="news-title">${post.title}</h3>
                        <div class="news-meta">
                            <span>ğŸ•’ ÙˆÙƒØ§Ù„Ø© ÙˆØ§Ø¹</span>
                            <span>Ø§Ù„ØªÙØ§ØµÙŠÙ„ â†</span>
                        </div>
                    </div>
                </a>
            `;
        });

        displayedCount += increment;
        loadMoreBtn.style.display = (displayedCount < allPosts.length) ? 'block' : 'none';
    }

    function startTicker() {
        const content = document.getElementById('breaking-content');
        if(!allPosts.length) return;
        content.innerText = allPosts[0].title;
        if(window.tickerInterval) clearInterval(window.tickerInterval);
        window.tickerInterval = setInterval(() => {
            content.style.opacity = 0;
            setTimeout(() => {
                breakingIndex = (breakingIndex + 1) % Math.min(allPosts.length, 15);
                content.innerText = allPosts[breakingIndex].title;
                content.style.opacity = 1;
            }, 500);
        }, 6000);
    }

    function changeCategory(cat, btn) {
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        fetchNews(cat);
    }

    fetchNews();
</script>
</body>
</html>
